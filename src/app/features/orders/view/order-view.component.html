<div class="order-view">

    <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>

    <header class="order-view__header">
        <div class="order-view__header-left">
            <button class="order-view__back-button" (click)="goBack()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M7.99998 12.6668L3.33331 8.00016M3.33331 8.00016L7.99998 3.3335M3.33331 8.00016H12.6666" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="order-view__title-container">
                <h1 class="order-view__title">
                    <svg class="order-view__icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                        <line x1="12" y1="22.08" x2="12" y2="12"></line>
                    </svg>
                    Inquiry ID: {{ order?.orderNumber }}
                </h1>
                <span class="order-view__status">New</span>
            </div>
        </div>
        <div class="order-view__header-right">
            <button class="order-view__export-button" (click)="exportOrder()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M14 10V12.6667C14 13.0203 13.8595 13.3594 13.6095 13.6095C13.3594 13.8595 13.0203 14 12.6667 14H3.33333C2.97971 14 2.64057 13.8595 2.39052 13.6095C2.14048 13.3594 2 13.0203 2 12.6667V10M4.66667 6.66667L8 10M8 10L11.3333 6.66667M8 10V2" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Export
            </button>

            <button class="order-view__print-button" (click)="printOrder()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M4 5.33333V1.33333H12V5.33333M4 12H2.66667C2.31305 12 1.97391 11.8595 1.72386 11.6095C1.47381 11.3594 1.33333 11.0203 1.33333 10.6667V6.66667C1.33333 6.31305 1.47381 5.97391 1.72386 5.72386C1.97391 5.47381 2.31305 5.33333 2.66667 5.33333H13.3333C13.687 5.33333 14.0261 5.47381 14.2761 5.72386C14.5262 5.97391 14.6667 6.31305 14.6667 6.66667V10.6667C14.6667 11.0203 14.5262 11.3594 14.2761 11.6095C14.0261 11.8595 13.687 12 13.3333 12H12M4 9.33333H12V14.6667H4V9.33333Z" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Print
            </button>

            <button class="order-view__save-button" (click)="saveOrder()">
                Save
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2.66657 9.93284C2.17126 9.42679 1.79761 8.81465 1.57392 8.1428C1.35023 7.47095 1.28237 6.75701 1.37547 6.05504C1.46858 5.35308 1.7202 4.68151 2.1113 4.0912C2.50239 3.50089 3.02269 3.00732 3.63279 2.64788C4.24289 2.28843 4.92678 2.07255 5.63268 2.01656C6.33857 1.96058 7.04795 2.06597 7.70708 2.32475C8.36621 2.58353 8.9578 2.98892 9.43706 3.5102C9.91631 4.03149 10.2706 4.655 10.4732 5.33351H11.6666C12.3102 5.33344 12.9369 5.54039 13.4539 5.9238C13.9709 6.30722 14.3509 6.84675 14.5377 7.46271C14.7246 8.07868 14.7084 8.7384 14.4915 9.34443C14.2746 9.95045 13.8685 10.4707 13.3332 10.8282M8 8.00016V14.0002M8 8.00016L10.6667 10.6668M8 8.00016L5.33333 10.6668" stroke="white" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </header>

    <div class="order-view__content">
        <!-- Display loading state -->
        <div class="order-view__loading" *ngIf="isLoading">
            <div class="order-view__spinner"></div>
            <p>Loading order details...</p>
        </div>

        <!-- Display error message if there's an error -->
        <div class="order-view__error" *ngIf="error && !isLoading">
            <p>{{ error }}</p>
            <button class="order-view__retry-button" (click)="loadOrderData()">Retry</button>
        </div>

        <!-- Display order details when loaded -->
        <div class="order-view__details" *ngIf="!isLoading && !error">
            <div class="order-view__info-row">
                <!-- Basic Information Section -->
                <div class="order-view__info-card">
                    <h2 class="order-view__section-title">Basic information</h2>

                    <div class="order-view__field-toggle">
                        <span class="order-view__field-label">Enable sale</span>
                        <div class="order-view__toggle">
                            <div class="order-view__toggle-slider"></div>
                        </div>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Account</span>
                        <span class="order-view__field-value">Unistrap Gmbh - finanz.ke[at]starlinger.com</span>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Contact</span>
                        <span class="order-view__field-value">Martina Kemper - Unistrap Gmbh</span>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Contact</span>
                        <div class="order-view__tag">
                            <span>Martina Kemper - Unistrap Gmbh</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">
                                <path d="M8.33341 1.6665L1.66675 8.33317M1.66675 1.6665L8.33341 8.33317" stroke="#71717A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Billing address</span>
                        <div class="order-view__tag">
                            <span>1060 Wien, Sonnenuhrgasse 4</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">
                                <path d="M8.33341 1.6665L1.66675 8.33317M1.66675 1.6665L8.33341 8.33317" stroke="#71717A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Status</span>
                        <div class="order-view__tag">
                            <span>New</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">
                                <path d="M8.33341 1.6665L1.66675 8.33317M1.66675 1.6665L8.33341 8.33317" stroke="#71717A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Date</span>
                        <span class="order-view__field-value">09/04/2025</span>
                    </div>
                </div>

                <!-- Order Address Section -->
                <div class="order-view__info-card">
                    <h2 class="order-view__section-title">Order address</h2>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Payment type</span>
                        <div class="order-view__tag">
                            <span>Bank transfer</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">
                                <path d="M8.33341 1.6665L1.66675 8.33317M1.66675 1.6665L8.33341 8.33317" stroke="#71717A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Delivery type</span>
                        <div class="order-view__tag">
                            <span>DHL</span>
                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 10 10" fill="none">
                                <path d="M8.33341 1.6665L1.66675 8.33317M1.66675 1.6665L8.33341 8.33317" stroke="#71717A" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Price without tax</span>
                        <span class="order-view__field-value">€ 4.764,74</span>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Total price</span>
                        <span class="order-view__field-value">€ 5.724,20</span>
                    </div>

                    <div class="order-view__field">
                        <span class="order-view__field-label">Price tax</span>
                        <span class="order-view__field-value">€ 956,40</span>
                    </div>
                </div>
            </div>

            <!-- Products Ordered Section -->
            <div class="order-view__products-section">
                <h2 class="order-view__section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M6.25 3.55802L13.75 7.84969M2.75004 5.83301L10 9.99967M10 9.99967L17.25 5.83301M10 9.99967L10 18.333M17.5 6.66626C17.4997 6.37399 17.4225 6.08693 17.2763 5.8339C17.13 5.58086 16.9198 5.37073 16.6667 5.22459L10.8333 1.89126C10.58 1.74498 10.2926 1.66797 10 1.66797C9.70744 1.66797 9.42003 1.74498 9.16667 1.89126L3.33333 5.22459C3.08022 5.37073 2.86998 5.58086 2.72372 5.8339C2.57745 6.08693 2.5003 6.37399 2.5 6.66626V13.3329C2.5003 13.6252 2.57745 13.9123 2.72372 14.1653C2.86998 14.4183 3.08022 14.6285 3.33333 14.7746L9.16667 18.1079C9.42003 18.2542 9.70744 18.3312 10 18.3312C10.2926 18.3312 10.58 18.2542 10.8333 18.1079L16.6667 14.7746C16.9198 14.6285 17.13 14.4183 17.2763 14.1653C17.4225 13.9123 17.4997 13.6252 17.5 13.3329V6.66626Z" stroke="#232323" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Products ordered
                </h2>

                <!-- Machine section -->
                <div class="order-view__machine-section" *ngFor="let machine of machines">
                    <div class="order-view__machine-header" (click)="toggleMachine(machine)">
                        <div class="order-view__machine-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none" [style.transform]="machine.isOpen ? 'rotate(90deg)' : ''">
                                <path d="M6 12L10 8L6 4" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            {{ machine.name }}
                        </div>
                        <div class="order-view__machine-action">
                            <span>Close</span>
                        </div>
                    </div>

                    <!-- Machine products table -->
                    <div class="order-view__table-container" *ngIf="machine.isOpen">
                        <table class="order-view__table">
                            <thead>
                            <tr>
                                <th class="order-view__table-header">Part no.</th>
                                <th class="order-view__table-header">Product name</th>
                                <th class="order-view__table-header">Weight</th>
                                <th class="order-view__table-header">Quantity</th>
                                <th class="order-view__table-header">Unit price</th>
                                <th class="order-view__table-header">Discount</th>
                                <th class="order-view__table-header">Price</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="order-view__table-row" *ngFor="let product of machine.products">
                                <td class="order-view__table-cell">{{ product.partNo }}</td>
                                <td class="order-view__table-cell">{{ product.productName }}</td>
                                <td class="order-view__table-cell">{{ product.weight }}</td>
                                <td class="order-view__table-cell">{{ product.quantity }}</td>
                                <td class="order-view__table-cell">€ {{ product.unitPrice.toFixed(2).replace('.', ',') }}</td>
                                <td class="order-view__table-cell">{{ product.discount }}</td>
                                <td class="order-view__table-cell">€ {{ product.price.toFixed(2).replace('.', ',') }}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Total section -->
                <div class="order-view__total-section">
                    <div class="order-view__total-row">
                        <span class="order-view__total-label">Total price</span>
                        <span class="order-view__total-value">€ {{ grandTotal.toFixed(2).replace('.', ',') }}</span>
                    </div>

                    <div class="order-view__amount-paid">
                        <span class="order-view__amount-paid-label">Amount paid</span>
                        <span class="order-view__amount-paid-value">€ {{ amountPaid.toFixed(3).replace('.', ',') }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
