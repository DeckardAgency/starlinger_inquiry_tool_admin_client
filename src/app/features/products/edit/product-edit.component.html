<div class="product-new">

    <app-breadcrumbs [items]="breadcrumbs"></app-breadcrumbs>

    <header class="product-new__header">
        <div class="product-new__header-left">
            <button class="product-new__back-button" (click)="goBack()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M7.99998 12.6668L3.33331 8.00016M3.33331 8.00016L7.99998 3.3335M3.33331 8.00016H12.6666" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="product-new__title-container">
                <!-- Shimmer for product code when loading -->
                <ng-container *ngIf="!dataLoaded && route.snapshot.paramMap.get('id'); else loadedProductCode">
                    <span class="product-new__skeleton-product-code"></span>
                </ng-container>
                <ng-template #loadedProductCode>
                    <span class="product-new__product-code">{{ productForm.get('partNo')?.value || '' }}</span>
                </ng-template>

                <!-- Shimmer for title when loading -->
                <ng-container *ngIf="!dataLoaded && route.snapshot.paramMap.get('id'); else loadedTitle">
                    <h1 class="product-new__skeleton-title"></h1>
                </ng-container>
                <ng-template #loadedTitle>
                    <h1 class="product-new__title">{{ productForm.get('name')?.value || '' }}</h1>
                </ng-template>
            </div>
        </div>
        <div class="product-new__header-right">
            <button class="product-new__save-continue-button" (click)="saveAndContinue()" [disabled]="!dataLoaded && route.snapshot.paramMap.get('id')">
                Save and continue
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M6 12L10 8L6 4" stroke="#232323" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <button class="product-new__save-button" (click)="saveProduct()" [disabled]="!dataLoaded && route.snapshot.paramMap.get('id')">
                Save
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M2.66657 9.93284C2.17126 9.42679 1.79761 8.81465 1.57392 8.1428C1.35023 7.47095 1.28237 6.75701 1.37547 6.05504C1.46858 5.35308 1.7202 4.68151 2.1113 4.0912C2.50239 3.50089 3.02269 3.00732 3.63279 2.64788C4.24289 2.28843 4.92678 2.07255 5.63268 2.01656C6.33857 1.96058 7.04795 2.06597 7.70708 2.32475C8.36621 2.58353 8.9578 2.98892 9.43706 3.5102C9.91631 4.03149 10.2706 4.655 10.4732 5.33351H11.6666C12.3102 5.33344 12.9369 5.54039 13.4539 5.9238C13.9709 6.30722 14.3509 6.84675 14.5377 7.46271C14.7246 8.07868 14.7084 8.7384 14.4915 9.34443C14.2746 9.95045 13.8685 10.4707 13.3332 10.8282M8 8.00016V14.0002M8 8.00016L10.6667 10.6668M8 8.00016L5.33333 10.6668" stroke="white" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </header>

    <div class="product-new__content">
        <form [formGroup]="productForm" class="product-new__form">
            <div class="product-new__form-top">
                <!-- Basic Details Section -->
                <div class="product-new__section">

                    <h2 class="product-new__section-title">Basic details</h2>

                    <div class="product-new__field-row" *ngFor="let field of ['name', 'slug', 'partNo', 'unit', 'weight']">
                        <div class="product-new__field">
                            <label class="product-new__label">{{ field === 'partNo' ? 'partNo' : (field | titlecase) }}</label>

                            <!-- Shimmer skeleton when loading -->
                            <ng-container *ngIf="!dataLoaded && route.snapshot.paramMap.get('id'); else loadedField">
                                <div class="product-new__skeleton-field"></div>
                            </ng-container>

                            <!-- Actual input field when loaded -->
                            <ng-template #loadedField>
                                <input type="text" class="product-new__input" [formControlName]="field">
                            </ng-template>
                        </div>
                    </div>
                </div>

                <!-- Prices Section -->
                <div class="product-new__section">
                    <h2 class="product-new__section-title">Prices</h2>

                    <div class="product-new__field-row">
                        <div class="product-new__field">
                            <label class="product-new__label">Price</label>

                            <!-- Shimmer skeleton when loading -->
                            <ng-container *ngIf="!dataLoaded && route.snapshot.paramMap.get('id'); else loadedPriceField">
                                <div class="product-new__skeleton-field"></div>
                            </ng-container>

                            <!-- Actual input field when loaded -->
                            <ng-template #loadedPriceField>
                                <input type="text" class="product-new__input" formControlName="price">
                            </ng-template>

                        </div>
                    </div>
                </div>
            </div>

            <div class="product-new__form-body">
                <!-- Tabs Section -->
                <div class="product-new__tabs">
                    <button
                            class="product-new__tab"
                            [class.product-new__tab--active]="activeTab === 'shortDescription'"
                            (click)="setActiveTab('shortDescription')">
                        Short Description
                    </button>

                    <button
                            class="product-new__tab"
                            [class.product-new__tab--active]="activeTab === 'technicalDescription'"
                            (click)="setActiveTab('technicalDescription')">
                        Technical Description
                    </button>

                    <button
                            class="product-new__tab"
                            [class.product-new__tab--active]="activeTab === 'featuredImage'"
                            (click)="setActiveTab('featuredImage')">
                        Featured Image
                    </button>

                    <button
                            class="product-new__tab"
                            [class.product-new__tab--active]="activeTab === 'imageGallery'"
                            (click)="setActiveTab('imageGallery')">
                        Image Gallery
                    </button>

                    <button
                            class="product-new__tab"
                            [class.product-new__tab--active]="activeTab === 'productDocuments'"
                            (click)="setActiveTab('productDocuments')">
                        Product Documents
                    </button>
                </div>

                <!-- Tab Indicator Animation -->
                <div class="product-new__tab-indicator" [@tabIndicator]="activeTab"></div>

                <!-- Tab Content with Animations -->
                <div class="product-new__tab-content">
                    <!-- shortDescription Section -->
                    <div class="product-new__editor-container product-new__short-description-container"
                         *ngIf="activeTab === 'shortDescription'"
                         [@tabAnimation]>
                        <!-- Show shimmer when loading -->
                        <div *ngIf="!dataLoaded && route.snapshot.paramMap.get('id')" class="product-new__loading-overlay">
                            <div class="product-new__loading-text">Loading content...</div>
                        </div>
                        <!-- Show editor when data is loaded -->
                        <app-text-editor
                                *ngIf="dataLoaded || !route.snapshot.paramMap.get('id')"
                                [initialContent]="getFormControlValue('shortDescription')"
                                (contentChange)="onShortDescriptionChange($event)"
                        ></app-text-editor>
                    </div>

                    <!-- technicalDescription Section -->
                    <div class="product-new__editor-container product-new__technical-description-container"
                         *ngIf="activeTab === 'technicalDescription'"
                         [@tabAnimation]>
                        <!-- Show shimmer when loading -->
                        <div *ngIf="!dataLoaded && route.snapshot.paramMap.get('id')" class="product-new__loading-overlay">
                            <div class="product-new__loading-text">Loading content...</div>
                        </div>
                        <!-- Show editor when data is loaded -->
                        <app-text-editor
                                *ngIf="dataLoaded || !route.snapshot.paramMap.get('id')"
                                [initialContent]="getFormControlValue('technicalDescription')"
                                (contentChange)="onTechnicalDescriptionChange($event)"
                        ></app-text-editor>
                    </div>

                    <!-- featuredImage Section -->
                    <div class="product-new__editor-container product-new__featured-image-container"
                         *ngIf="activeTab === 'featuredImage'"
                         [@tabAnimation]>
                        <!-- Show shimmer when loading -->
                        <div *ngIf="!dataLoaded && route.snapshot.paramMap.get('id')" class="product-new__skeleton-image"></div>
                        <!-- Show featured image selector when data is loaded -->
                        <app-product-featured-image
                                *ngIf="dataLoaded || !route.snapshot.paramMap.get('id')"
                                [featuredImage]="productForm.get('featuredImage')?.value"
                                (featuredImageChange)="onFeaturedImageChange($event)">
                        </app-product-featured-image>
                    </div>

                    <!-- imageGallery Section -->
                    <div class="product-new__editor-container product-new__image-gallery-container"
                         *ngIf="activeTab === 'imageGallery'"
                         [@tabAnimation]>
                        <!-- Show shimmer when loading -->
                        <div *ngIf="!dataLoaded && route.snapshot.paramMap.get('id')" class="product-new__loading-overlay">
                            <div class="product-new__loading-text">Loading gallery...</div>
                        </div>
                        <!-- Show image gallery when data is loaded -->
                        <app-product-image-gallery
                                *ngIf="dataLoaded || !route.snapshot.paramMap.get('id')"
                                [mediaItems]="productForm.get('imageGallery')?.value || []"
                                (mediaItemsChange)="onImageGalleryChange($event)">
                        </app-product-image-gallery>
                    </div>

                    <!-- productDocuments Section -->
                    <div class="product-new__editor-container product-new__product-documents"
                         *ngIf="activeTab === 'productDocuments'"
                         [@tabAnimation]>
                        Product documents content
                    </div>
                </div>
            </div>
        </form>

        <form [formGroup]="selectForm" (ngSubmit)="onSubmit()">
            <!-- Basic Select -->
            <div class="form-group">
                <label for="color">Basic Select:</label>
                <app-select
                    formControlName="color"
                    [options]="colors"
                    (selectionChange)="onSelectionChange($event)"
                    placeholder="Select a color">
                </app-select>
            </div>

            <!-- Object Array Select -->
            <div class="form-group">
                <label for="country">Country Select with Objects:</label>
                <app-select
                    formControlName="country"
                    [options]="countries"
                    displayField="name"
                    valueField="id"
                    placeholder="Select a country">
                </app-select>
            </div>

            <!-- Searchable Select -->
            <div class="form-group">
                <label for="searchableCountry">Searchable Country Select:</label>
                <app-select
                    formControlName="searchableCountry"
                    [options]="countries"
                    displayField="name"
                    valueField="id"
                    [searchable]="true"
                    placeholder="Search and select a country">
                </app-select>
            </div>

            <!-- Multiple Select -->
            <div class="form-group">
                <label for="languages">Multiple Select:</label>
                <app-select
                    formControlName="languages"
                    [options]="programmingLanguages"
                    [multiple]="true"
                    placeholder="Select programming languages">
                </app-select>
            </div>

            <!-- Multiple Searchable Select -->
            <div class="form-group">
                <label for="skills">Multiple Searchable Select:</label>
                <app-select
                    formControlName="skills"
                    [options]="skills"
                    [multiple]="true"
                    [searchable]="true"
                    placeholder="Search and select skills">
                </app-select>
            </div>

            <!-- Required Select -->
            <div class="form-group">
                <label for="role">Required Select:</label>
                <app-select
                    formControlName="role"
                    [options]="roles"
                    [required]="true"
                    placeholder="Select a role (required)">
                </app-select>
                <div class="error-message" *ngIf="selectForm.get('role')?.invalid && selectForm.get('role')?.touched">
                    This field is required
                </div>
            </div>

            <!-- Disabled Select -->
            <div class="form-group">
                <label for="disabledOption">Disabled Select:</label>
                <app-select
                    formControlName="disabledOption"
                    [options]="disabledOptions"
                    [disabled]="true"
                    placeholder="This select is disabled">
                </app-select>
            </div>

            <button type="submit" [disabled]="selectForm.invalid">Submit</button>
        </form>

        <div class="form-values" *ngIf="submitted">
            <h2>Form Values:</h2>
            <pre>{{ formValues | json }}</pre>
        </div>
    </div>
</div>
